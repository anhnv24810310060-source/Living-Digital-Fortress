# WireGuard Mesh Configuration for ShieldX Services
# Auto-generated configuration for service-to-service encrypted communication

mesh:
  name: shieldx-mesh
  network: 10.99.0.0/16
  port: 51820
  dns: 1.1.1.1,8.8.8.8
  
nodes:
  - name: ingress
    private_key_env: WG_INGRESS_PRIVATE_KEY
    address: 10.99.0.10/32
    listen_port: 51820
    peers:
      - guardian
      - orchestrator
      - locator
    allowed_ips:
      - 10.99.0.0/16
    
  - name: gateway
    private_key_env: WG_GATEWAY_PRIVATE_KEY
    address: 10.99.0.20/32
    listen_port: 51821
    peers:
      - verifier-pool
      - ml-orchestrator
      - contauth
    allowed_ips:
      - 10.99.0.0/16
    
  - name: guardian
    private_key_env: WG_GUARDIAN_PRIVATE_KEY
    address: 10.99.0.30/32
    listen_port: 51822
    peers:
      - ingress
      - orchestrator
    allowed_ips:
      - 10.99.0.0/16
    
  - name: orchestrator
    private_key_env: WG_ORCHESTRATOR_PRIVATE_KEY
    address: 10.99.0.40/32
    listen_port: 51823
    peers:
      - ingress
      - guardian
      - locator
      - gateway
    allowed_ips:
      - 10.99.0.0/16
    
  - name: contauth
    private_key_env: WG_CONTAUTH_PRIVATE_KEY
    address: 10.99.0.50/32
    listen_port: 51824
    peers:
      - gateway
      - orchestrator
    allowed_ips:
      - 10.99.0.0/16
    
  - name: verifier-pool
    private_key_env: WG_VERIFIER_PRIVATE_KEY
    address: 10.99.0.60/32
    listen_port: 51825
    peers:
      - gateway
      - orchestrator
    allowed_ips:
      - 10.99.0.0/16
    
  - name: ml-orchestrator
    private_key_env: WG_ML_ORCH_PRIVATE_KEY
    address: 10.99.0.70/32
    listen_port: 51826
    peers:
      - gateway
      - orchestrator
    allowed_ips:
      - 10.99.0.0/16
    
  - name: locator
    private_key_env: WG_LOCATOR_PRIVATE_KEY
    address: 10.99.0.80/32
    listen_port: 51827
    peers:
      - ingress
      - orchestrator
    allowed_ips:
      - 10.99.0.0/16

# Security policies
security:
  allowed_ips:
    - 10.99.0.0/16
  
  persistent_keepalive: 25
  
  firewall_rules:
    - "allow wireguard port 51820-51830"
    - "allow established,related"
    - "deny all by default"
  
  mtu: 1420
  table: auto
